#!/usr/bin/env ruby

require 'optparse'

require_relative '../test/tool/test_builder'
require_relative '../test/tool/cdp_test_builder'

options = {}

OptionParser.new do |opt|
  opt.banner = 'Usage: bin/gentest [file] [option]'
  opt.on('-m METHOD', 'Method name in the test file') do |m|
    options[:method] = m
  end
  opt.on('-c CLASS', 'Class name in the test file') do |c|
    options[:class] = c
  end
  opt.on('--open=[FRONTEND]', 'Start remote debugging with opening the network port.',
                              'Currently, only Chrome is supported.'
    ) do |f|
    options[:open] = f.downcase
  end
  opt.on('--port=PORT', 'Listening TCP/IP port') do |port|
    options[:port] = port
  end
  opt.parse!(ARGV)
end

exit if ARGV.empty?

if options[:open] == 'chrome'
  DEBUGGER__::CDPTestBuilder.new(ARGV, options[:method], options[:class], options[:port]).start
else
  DEBUGGER__::TestBuilder.new(ARGV, options[:method], options[:class]).start
end
